(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){

var ko = require('knockout');
var components = require('ungit-components');
var programEvents = require('ungit-program-events');
var navigation = require('ungit-navigation');

components.register('app', function(args) {
  return new AppViewModel(args.appContainer, args.server);
});

var AppViewModel = function(appContainer, server) {
  var self = this;
  this.appContainer = appContainer;
  this.server = server;
  if (window.location.search.indexOf('noheader=true') < 0)
    this.header = components.create('header', { app: this });
  this.dialog = ko.observable(null);

  this.repoList = ko.observableArray(JSON.parse(localStorage.getItem('repositories') || localStorage.getItem('visitedRepositories') || '[]')); // visitedRepositories is legacy, remove in the next version
  this.repoList.subscribe(function(newValue) { localStorage.setItem('repositories', JSON.stringify(newValue)); });

  this.content = ko.observable(components.create('home', { app: this }));
  this.currentVersion = ko.observable();
  this.latestVersion = ko.observable();
  this.showNewVersionAvailable = ko.observable();
  this.newVersionInstallCommand = (ungit.platform == 'win32' ? '' : 'sudo -H ') + 'npm update -g ungit';
  this.bugtrackingEnabled = ko.observable(ungit.config.bugtracking);

  this.bugtrackingNagscreenDismissed = ko.observable(localStorage.getItem('bugtrackingNagscreenDismissed'));
  this.showBugtrackingNagscreen = ko.computed(function() {
    return !self.bugtrackingEnabled() && !self.bugtrackingNagscreenDismissed();
  });

  this.gitVersionErrorDismissed = ko.observable(localStorage.getItem('gitVersionErrorDismissed'));
  this.gitVersionError = ko.observable();
  this.gitVersionErrorVisible = ko.computed(function() {
    return !ungit.config.gitVersionCheckOverride && self.gitVersionError() && !self.gitVersionErrorDismissed();
  });

  var NPSSurveyLastDismissed = parseInt(localStorage.getItem('NPSSurveyLastDismissed') || '0');
  var monthsSinceNPSLastDismissed = (Date.now() - NPSSurveyLastDismissed) / (1000 * 60 * 60 * 24 * 30);
  this.showNPSSurvey = ko.observable(monthsSinceNPSLastDismissed >= 6 && Math.random() < 0.01);
  this.sendNPS = function(value) {
    keen.addEvent('survey-nps', {
      version: ungit.version,
      userHash: ungit.userHash,
      rating: value,
      bugtrackingEnabled: ungit.config.bugtracking,
      sendUsageStatistics: ungit.config.sendUsageStatistics
    });
    self.dismissNPSSurvey();
  }

}

AppViewModel.prototype.updateNode = function(parentElement) {
  ko.renderTemplate('app', this, {}, parentElement);
}
AppViewModel.prototype.template = 'app';
AppViewModel.prototype.shown = function() {
  var self = this;
  // The ungit.config variable collections configuration from all different paths and only updates when
  // ungit is restarted
  if(!ungit.config.bugtracking) {
    // Whereas the userconfig only reflects what's in the ~/.ungitrc and updates directly,
    // but is only used for changing around the configuration. We need to check this here
    // since ungit may have crashed without the server crashing since we enabled bugtracking,
    // and we don't want to show the nagscreen twice in that case.
    this.server.getPromise('/userconfig')
      .then(function(userConfig) { self.bugtrackingEnabled(userConfig.bugtracking); });
  }

  this.server.getPromise('/latestversion')
    .then(function(version) {
      if (!version) return;
      self.currentVersion(version.currentVersion);
      self.latestVersion(version.latestVersion);
      self.showNewVersionAvailable(!ungit.config.ungitVersionCheckOverride && version.outdated);
    });
  this.server.getPromise('/gitversion')
    .then(function(gitversion) {
      if (gitversion && !gitversion.satisfied) {
        self.gitVersionError(gitversion.error);
      }
    });
}
AppViewModel.prototype.updateAnimationFrame = function(deltaT) {
  if (this.content() && this.content().updateAnimationFrame) this.content().updateAnimationFrame(deltaT);
}
AppViewModel.prototype.onProgramEvent = function(event) {
  if (event.event == 'request-credentials') this._handleCredentialsRequested(event);
  else if (event.event == 'request-show-dialog') this.showDialog(event.dialog);
  else if (event.event == 'request-remember-repo') this._handleRequestRememberRepo(event);

  if (this.content() && this.content().onProgramEvent)
    this.content().onProgramEvent(event);
  if (this.header && this.header.onProgramEvent) this.header.onProgramEvent(event);
}
AppViewModel.prototype._handleRequestRememberRepo = function(event) {
  var repoPath = event.repoPath;
  if (this.repoList.indexOf(repoPath) != -1) return;
  this.repoList.push(repoPath);
}
AppViewModel.prototype._handleCredentialsRequested = function() {
  var self = this;
  // Only show one credentials dialog if we're asked to show another one while the first one is open
  // This happens for instance when we fetch nodes and remote tags at the same time
  if (!this._isShowingCredentialsDialog) {
    this._isShowingCredentialsDialog = true;
    components.create('credentialsdialog').show().closeThen(function(diag) {
      self._isShowingCredentialsDialog = false;
      programEvents.dispatch({ event: 'request-credentials-response', username: diag.username(), password: diag.password() });
    });
  }
}
AppViewModel.prototype.showDialog = function(dialog) {
  var self = this;
  this.dialog(dialog.closeThen(function() {
    self.dialog(null);
    return dialog;
  }));
}
AppViewModel.prototype.gitSetUserConfig = function(bugTracking, sendUsageStatistics) {
  var self = this;
  this.server.getPromise('/userconfig')
    .then(function(userConfig) {
      userConfig.bugtracking = bugTracking;
      if (sendUsageStatistics != undefined) userConfig.sendUsageStatistics = sendUsageStatistics;
      return self.server.postPromise('/userconfig', userConfig)
        .then(function() { self.bugtrackingEnabled(bugTracking); });
    }).catch(function(err) { })
}
AppViewModel.prototype.enableBugtrackingAndStatistics = function() {
  this.gitSetUserConfig(true, true);
}
AppViewModel.prototype.enableBugtracking = function() {
  this.gitSetUserConfig(true);
}
AppViewModel.prototype.dismissBugtrackingNagscreen = function() {
  localStorage.setItem('bugtrackingNagscreenDismissed', true);
  this.bugtrackingNagscreenDismissed(true);
}
AppViewModel.prototype.dismissGitVersionError = function() {
  localStorage.setItem('gitVersionErrorDismissed', true);
  this.gitVersionErrorDismissed(true);
}
AppViewModel.prototype.dismissNPSSurvey = function() {
  this.showNPSSurvey(false);
  localStorage.setItem('NPSSurveyLastDismissed', Date.now());
}
AppViewModel.prototype.dismissNewVersion = function() {
  this.showNewVersionAvailable(false);
}
AppViewModel.prototype.templateChooser = function(data) {
  if (!data) return '';
  return data.template;
};

},{"knockout":"knockout","ungit-components":"ungit-components","ungit-navigation":"ungit-navigation","ungit-program-events":"ungit-program-events"}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJjb21wb25lbnRzL2FwcC9hcHAuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIlxudmFyIGtvID0gcmVxdWlyZSgna25vY2tvdXQnKTtcbnZhciBjb21wb25lbnRzID0gcmVxdWlyZSgndW5naXQtY29tcG9uZW50cycpO1xudmFyIHByb2dyYW1FdmVudHMgPSByZXF1aXJlKCd1bmdpdC1wcm9ncmFtLWV2ZW50cycpO1xudmFyIG5hdmlnYXRpb24gPSByZXF1aXJlKCd1bmdpdC1uYXZpZ2F0aW9uJyk7XG5cbmNvbXBvbmVudHMucmVnaXN0ZXIoJ2FwcCcsIGZ1bmN0aW9uKGFyZ3MpIHtcbiAgcmV0dXJuIG5ldyBBcHBWaWV3TW9kZWwoYXJncy5hcHBDb250YWluZXIsIGFyZ3Muc2VydmVyKTtcbn0pO1xuXG52YXIgQXBwVmlld01vZGVsID0gZnVuY3Rpb24oYXBwQ29udGFpbmVyLCBzZXJ2ZXIpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLmFwcENvbnRhaW5lciA9IGFwcENvbnRhaW5lcjtcbiAgdGhpcy5zZXJ2ZXIgPSBzZXJ2ZXI7XG4gIGlmICh3aW5kb3cubG9jYXRpb24uc2VhcmNoLmluZGV4T2YoJ25vaGVhZGVyPXRydWUnKSA8IDApXG4gICAgdGhpcy5oZWFkZXIgPSBjb21wb25lbnRzLmNyZWF0ZSgnaGVhZGVyJywgeyBhcHA6IHRoaXMgfSk7XG4gIHRoaXMuZGlhbG9nID0ga28ub2JzZXJ2YWJsZShudWxsKTtcblxuICB0aGlzLnJlcG9MaXN0ID0ga28ub2JzZXJ2YWJsZUFycmF5KEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3JlcG9zaXRvcmllcycpIHx8IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd2aXNpdGVkUmVwb3NpdG9yaWVzJykgfHwgJ1tdJykpOyAvLyB2aXNpdGVkUmVwb3NpdG9yaWVzIGlzIGxlZ2FjeSwgcmVtb3ZlIGluIHRoZSBuZXh0IHZlcnNpb25cbiAgdGhpcy5yZXBvTGlzdC5zdWJzY3JpYmUoZnVuY3Rpb24obmV3VmFsdWUpIHsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3JlcG9zaXRvcmllcycsIEpTT04uc3RyaW5naWZ5KG5ld1ZhbHVlKSk7IH0pO1xuXG4gIHRoaXMuY29udGVudCA9IGtvLm9ic2VydmFibGUoY29tcG9uZW50cy5jcmVhdGUoJ2hvbWUnLCB7IGFwcDogdGhpcyB9KSk7XG4gIHRoaXMuY3VycmVudFZlcnNpb24gPSBrby5vYnNlcnZhYmxlKCk7XG4gIHRoaXMubGF0ZXN0VmVyc2lvbiA9IGtvLm9ic2VydmFibGUoKTtcbiAgdGhpcy5zaG93TmV3VmVyc2lvbkF2YWlsYWJsZSA9IGtvLm9ic2VydmFibGUoKTtcbiAgdGhpcy5uZXdWZXJzaW9uSW5zdGFsbENvbW1hbmQgPSAodW5naXQucGxhdGZvcm0gPT0gJ3dpbjMyJyA/ICcnIDogJ3N1ZG8gLUggJykgKyAnbnBtIHVwZGF0ZSAtZyB1bmdpdCc7XG4gIHRoaXMuYnVndHJhY2tpbmdFbmFibGVkID0ga28ub2JzZXJ2YWJsZSh1bmdpdC5jb25maWcuYnVndHJhY2tpbmcpO1xuXG4gIHRoaXMuYnVndHJhY2tpbmdOYWdzY3JlZW5EaXNtaXNzZWQgPSBrby5vYnNlcnZhYmxlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdidWd0cmFja2luZ05hZ3NjcmVlbkRpc21pc3NlZCcpKTtcbiAgdGhpcy5zaG93QnVndHJhY2tpbmdOYWdzY3JlZW4gPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gIXNlbGYuYnVndHJhY2tpbmdFbmFibGVkKCkgJiYgIXNlbGYuYnVndHJhY2tpbmdOYWdzY3JlZW5EaXNtaXNzZWQoKTtcbiAgfSk7XG5cbiAgdGhpcy5naXRWZXJzaW9uRXJyb3JEaXNtaXNzZWQgPSBrby5vYnNlcnZhYmxlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdnaXRWZXJzaW9uRXJyb3JEaXNtaXNzZWQnKSk7XG4gIHRoaXMuZ2l0VmVyc2lvbkVycm9yID0ga28ub2JzZXJ2YWJsZSgpO1xuICB0aGlzLmdpdFZlcnNpb25FcnJvclZpc2libGUgPSBrby5jb21wdXRlZChmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gIXVuZ2l0LmNvbmZpZy5naXRWZXJzaW9uQ2hlY2tPdmVycmlkZSAmJiBzZWxmLmdpdFZlcnNpb25FcnJvcigpICYmICFzZWxmLmdpdFZlcnNpb25FcnJvckRpc21pc3NlZCgpO1xuICB9KTtcblxuICB2YXIgTlBTU3VydmV5TGFzdERpc21pc3NlZCA9IHBhcnNlSW50KGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdOUFNTdXJ2ZXlMYXN0RGlzbWlzc2VkJykgfHwgJzAnKTtcbiAgdmFyIG1vbnRoc1NpbmNlTlBTTGFzdERpc21pc3NlZCA9IChEYXRlLm5vdygpIC0gTlBTU3VydmV5TGFzdERpc21pc3NlZCkgLyAoMTAwMCAqIDYwICogNjAgKiAyNCAqIDMwKTtcbiAgdGhpcy5zaG93TlBTU3VydmV5ID0ga28ub2JzZXJ2YWJsZShtb250aHNTaW5jZU5QU0xhc3REaXNtaXNzZWQgPj0gNiAmJiBNYXRoLnJhbmRvbSgpIDwgMC4wMSk7XG4gIHRoaXMuc2VuZE5QUyA9IGZ1bmN0aW9uKHZhbHVlKSB7XG4gICAga2Vlbi5hZGRFdmVudCgnc3VydmV5LW5wcycsIHtcbiAgICAgIHZlcnNpb246IHVuZ2l0LnZlcnNpb24sXG4gICAgICB1c2VySGFzaDogdW5naXQudXNlckhhc2gsXG4gICAgICByYXRpbmc6IHZhbHVlLFxuICAgICAgYnVndHJhY2tpbmdFbmFibGVkOiB1bmdpdC5jb25maWcuYnVndHJhY2tpbmcsXG4gICAgICBzZW5kVXNhZ2VTdGF0aXN0aWNzOiB1bmdpdC5jb25maWcuc2VuZFVzYWdlU3RhdGlzdGljc1xuICAgIH0pO1xuICAgIHNlbGYuZGlzbWlzc05QU1N1cnZleSgpO1xuICB9XG5cbn1cblxuQXBwVmlld01vZGVsLnByb3RvdHlwZS51cGRhdGVOb2RlID0gZnVuY3Rpb24ocGFyZW50RWxlbWVudCkge1xuICBrby5yZW5kZXJUZW1wbGF0ZSgnYXBwJywgdGhpcywge30sIHBhcmVudEVsZW1lbnQpO1xufVxuQXBwVmlld01vZGVsLnByb3RvdHlwZS50ZW1wbGF0ZSA9ICdhcHAnO1xuQXBwVmlld01vZGVsLnByb3RvdHlwZS5zaG93biA9IGZ1bmN0aW9uKCkge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIC8vIFRoZSB1bmdpdC5jb25maWcgdmFyaWFibGUgY29sbGVjdGlvbnMgY29uZmlndXJhdGlvbiBmcm9tIGFsbCBkaWZmZXJlbnQgcGF0aHMgYW5kIG9ubHkgdXBkYXRlcyB3aGVuXG4gIC8vIHVuZ2l0IGlzIHJlc3RhcnRlZFxuICBpZighdW5naXQuY29uZmlnLmJ1Z3RyYWNraW5nKSB7XG4gICAgLy8gV2hlcmVhcyB0aGUgdXNlcmNvbmZpZyBvbmx5IHJlZmxlY3RzIHdoYXQncyBpbiB0aGUgfi8udW5naXRyYyBhbmQgdXBkYXRlcyBkaXJlY3RseSxcbiAgICAvLyBidXQgaXMgb25seSB1c2VkIGZvciBjaGFuZ2luZyBhcm91bmQgdGhlIGNvbmZpZ3VyYXRpb24uIFdlIG5lZWQgdG8gY2hlY2sgdGhpcyBoZXJlXG4gICAgLy8gc2luY2UgdW5naXQgbWF5IGhhdmUgY3Jhc2hlZCB3aXRob3V0IHRoZSBzZXJ2ZXIgY3Jhc2hpbmcgc2luY2Ugd2UgZW5hYmxlZCBidWd0cmFja2luZyxcbiAgICAvLyBhbmQgd2UgZG9uJ3Qgd2FudCB0byBzaG93IHRoZSBuYWdzY3JlZW4gdHdpY2UgaW4gdGhhdCBjYXNlLlxuICAgIHRoaXMuc2VydmVyLmdldFByb21pc2UoJy91c2VyY29uZmlnJylcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXJDb25maWcpIHsgc2VsZi5idWd0cmFja2luZ0VuYWJsZWQodXNlckNvbmZpZy5idWd0cmFja2luZyk7IH0pO1xuICB9XG5cbiAgdGhpcy5zZXJ2ZXIuZ2V0UHJvbWlzZSgnL2xhdGVzdHZlcnNpb24nKVxuICAgIC50aGVuKGZ1bmN0aW9uKHZlcnNpb24pIHtcbiAgICAgIGlmICghdmVyc2lvbikgcmV0dXJuO1xuICAgICAgc2VsZi5jdXJyZW50VmVyc2lvbih2ZXJzaW9uLmN1cnJlbnRWZXJzaW9uKTtcbiAgICAgIHNlbGYubGF0ZXN0VmVyc2lvbih2ZXJzaW9uLmxhdGVzdFZlcnNpb24pO1xuICAgICAgc2VsZi5zaG93TmV3VmVyc2lvbkF2YWlsYWJsZSghdW5naXQuY29uZmlnLnVuZ2l0VmVyc2lvbkNoZWNrT3ZlcnJpZGUgJiYgdmVyc2lvbi5vdXRkYXRlZCk7XG4gICAgfSk7XG4gIHRoaXMuc2VydmVyLmdldFByb21pc2UoJy9naXR2ZXJzaW9uJylcbiAgICAudGhlbihmdW5jdGlvbihnaXR2ZXJzaW9uKSB7XG4gICAgICBpZiAoZ2l0dmVyc2lvbiAmJiAhZ2l0dmVyc2lvbi5zYXRpc2ZpZWQpIHtcbiAgICAgICAgc2VsZi5naXRWZXJzaW9uRXJyb3IoZ2l0dmVyc2lvbi5lcnJvcik7XG4gICAgICB9XG4gICAgfSk7XG59XG5BcHBWaWV3TW9kZWwucHJvdG90eXBlLnVwZGF0ZUFuaW1hdGlvbkZyYW1lID0gZnVuY3Rpb24oZGVsdGFUKSB7XG4gIGlmICh0aGlzLmNvbnRlbnQoKSAmJiB0aGlzLmNvbnRlbnQoKS51cGRhdGVBbmltYXRpb25GcmFtZSkgdGhpcy5jb250ZW50KCkudXBkYXRlQW5pbWF0aW9uRnJhbWUoZGVsdGFUKTtcbn1cbkFwcFZpZXdNb2RlbC5wcm90b3R5cGUub25Qcm9ncmFtRXZlbnQgPSBmdW5jdGlvbihldmVudCkge1xuICBpZiAoZXZlbnQuZXZlbnQgPT0gJ3JlcXVlc3QtY3JlZGVudGlhbHMnKSB0aGlzLl9oYW5kbGVDcmVkZW50aWFsc1JlcXVlc3RlZChldmVudCk7XG4gIGVsc2UgaWYgKGV2ZW50LmV2ZW50ID09ICdyZXF1ZXN0LXNob3ctZGlhbG9nJykgdGhpcy5zaG93RGlhbG9nKGV2ZW50LmRpYWxvZyk7XG4gIGVsc2UgaWYgKGV2ZW50LmV2ZW50ID09ICdyZXF1ZXN0LXJlbWVtYmVyLXJlcG8nKSB0aGlzLl9oYW5kbGVSZXF1ZXN0UmVtZW1iZXJSZXBvKGV2ZW50KTtcblxuICBpZiAodGhpcy5jb250ZW50KCkgJiYgdGhpcy5jb250ZW50KCkub25Qcm9ncmFtRXZlbnQpXG4gICAgdGhpcy5jb250ZW50KCkub25Qcm9ncmFtRXZlbnQoZXZlbnQpO1xuICBpZiAodGhpcy5oZWFkZXIgJiYgdGhpcy5oZWFkZXIub25Qcm9ncmFtRXZlbnQpIHRoaXMuaGVhZGVyLm9uUHJvZ3JhbUV2ZW50KGV2ZW50KTtcbn1cbkFwcFZpZXdNb2RlbC5wcm90b3R5cGUuX2hhbmRsZVJlcXVlc3RSZW1lbWJlclJlcG8gPSBmdW5jdGlvbihldmVudCkge1xuICB2YXIgcmVwb1BhdGggPSBldmVudC5yZXBvUGF0aDtcbiAgaWYgKHRoaXMucmVwb0xpc3QuaW5kZXhPZihyZXBvUGF0aCkgIT0gLTEpIHJldHVybjtcbiAgdGhpcy5yZXBvTGlzdC5wdXNoKHJlcG9QYXRoKTtcbn1cbkFwcFZpZXdNb2RlbC5wcm90b3R5cGUuX2hhbmRsZUNyZWRlbnRpYWxzUmVxdWVzdGVkID0gZnVuY3Rpb24oKSB7XG4gIHZhciBzZWxmID0gdGhpcztcbiAgLy8gT25seSBzaG93IG9uZSBjcmVkZW50aWFscyBkaWFsb2cgaWYgd2UncmUgYXNrZWQgdG8gc2hvdyBhbm90aGVyIG9uZSB3aGlsZSB0aGUgZmlyc3Qgb25lIGlzIG9wZW5cbiAgLy8gVGhpcyBoYXBwZW5zIGZvciBpbnN0YW5jZSB3aGVuIHdlIGZldGNoIG5vZGVzIGFuZCByZW1vdGUgdGFncyBhdCB0aGUgc2FtZSB0aW1lXG4gIGlmICghdGhpcy5faXNTaG93aW5nQ3JlZGVudGlhbHNEaWFsb2cpIHtcbiAgICB0aGlzLl9pc1Nob3dpbmdDcmVkZW50aWFsc0RpYWxvZyA9IHRydWU7XG4gICAgY29tcG9uZW50cy5jcmVhdGUoJ2NyZWRlbnRpYWxzZGlhbG9nJykuc2hvdygpLmNsb3NlVGhlbihmdW5jdGlvbihkaWFnKSB7XG4gICAgICBzZWxmLl9pc1Nob3dpbmdDcmVkZW50aWFsc0RpYWxvZyA9IGZhbHNlO1xuICAgICAgcHJvZ3JhbUV2ZW50cy5kaXNwYXRjaCh7IGV2ZW50OiAncmVxdWVzdC1jcmVkZW50aWFscy1yZXNwb25zZScsIHVzZXJuYW1lOiBkaWFnLnVzZXJuYW1lKCksIHBhc3N3b3JkOiBkaWFnLnBhc3N3b3JkKCkgfSk7XG4gICAgfSk7XG4gIH1cbn1cbkFwcFZpZXdNb2RlbC5wcm90b3R5cGUuc2hvd0RpYWxvZyA9IGZ1bmN0aW9uKGRpYWxvZykge1xuICB2YXIgc2VsZiA9IHRoaXM7XG4gIHRoaXMuZGlhbG9nKGRpYWxvZy5jbG9zZVRoZW4oZnVuY3Rpb24oKSB7XG4gICAgc2VsZi5kaWFsb2cobnVsbCk7XG4gICAgcmV0dXJuIGRpYWxvZztcbiAgfSkpO1xufVxuQXBwVmlld01vZGVsLnByb3RvdHlwZS5naXRTZXRVc2VyQ29uZmlnID0gZnVuY3Rpb24oYnVnVHJhY2tpbmcsIHNlbmRVc2FnZVN0YXRpc3RpY3MpIHtcbiAgdmFyIHNlbGYgPSB0aGlzO1xuICB0aGlzLnNlcnZlci5nZXRQcm9taXNlKCcvdXNlcmNvbmZpZycpXG4gICAgLnRoZW4oZnVuY3Rpb24odXNlckNvbmZpZykge1xuICAgICAgdXNlckNvbmZpZy5idWd0cmFja2luZyA9IGJ1Z1RyYWNraW5nO1xuICAgICAgaWYgKHNlbmRVc2FnZVN0YXRpc3RpY3MgIT0gdW5kZWZpbmVkKSB1c2VyQ29uZmlnLnNlbmRVc2FnZVN0YXRpc3RpY3MgPSBzZW5kVXNhZ2VTdGF0aXN0aWNzO1xuICAgICAgcmV0dXJuIHNlbGYuc2VydmVyLnBvc3RQcm9taXNlKCcvdXNlcmNvbmZpZycsIHVzZXJDb25maWcpXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKCkgeyBzZWxmLmJ1Z3RyYWNraW5nRW5hYmxlZChidWdUcmFja2luZyk7IH0pO1xuICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikgeyB9KVxufVxuQXBwVmlld01vZGVsLnByb3RvdHlwZS5lbmFibGVCdWd0cmFja2luZ0FuZFN0YXRpc3RpY3MgPSBmdW5jdGlvbigpIHtcbiAgdGhpcy5naXRTZXRVc2VyQ29uZmlnKHRydWUsIHRydWUpO1xufVxuQXBwVmlld01vZGVsLnByb3RvdHlwZS5lbmFibGVCdWd0cmFja2luZyA9IGZ1bmN0aW9uKCkge1xuICB0aGlzLmdpdFNldFVzZXJDb25maWcodHJ1ZSk7XG59XG5BcHBWaWV3TW9kZWwucHJvdG90eXBlLmRpc21pc3NCdWd0cmFja2luZ05hZ3NjcmVlbiA9IGZ1bmN0aW9uKCkge1xuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYnVndHJhY2tpbmdOYWdzY3JlZW5EaXNtaXNzZWQnLCB0cnVlKTtcbiAgdGhpcy5idWd0cmFja2luZ05hZ3NjcmVlbkRpc21pc3NlZCh0cnVlKTtcbn1cbkFwcFZpZXdNb2RlbC5wcm90b3R5cGUuZGlzbWlzc0dpdFZlcnNpb25FcnJvciA9IGZ1bmN0aW9uKCkge1xuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnZ2l0VmVyc2lvbkVycm9yRGlzbWlzc2VkJywgdHJ1ZSk7XG4gIHRoaXMuZ2l0VmVyc2lvbkVycm9yRGlzbWlzc2VkKHRydWUpO1xufVxuQXBwVmlld01vZGVsLnByb3RvdHlwZS5kaXNtaXNzTlBTU3VydmV5ID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuc2hvd05QU1N1cnZleShmYWxzZSk7XG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdOUFNTdXJ2ZXlMYXN0RGlzbWlzc2VkJywgRGF0ZS5ub3coKSk7XG59XG5BcHBWaWV3TW9kZWwucHJvdG90eXBlLmRpc21pc3NOZXdWZXJzaW9uID0gZnVuY3Rpb24oKSB7XG4gIHRoaXMuc2hvd05ld1ZlcnNpb25BdmFpbGFibGUoZmFsc2UpO1xufVxuQXBwVmlld01vZGVsLnByb3RvdHlwZS50ZW1wbGF0ZUNob29zZXIgPSBmdW5jdGlvbihkYXRhKSB7XG4gIGlmICghZGF0YSkgcmV0dXJuICcnO1xuICByZXR1cm4gZGF0YS50ZW1wbGF0ZTtcbn07XG4iXX0=
